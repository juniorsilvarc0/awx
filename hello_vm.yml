- name: Hello VM Magalu
  hosts: all
  become: true
  gather_facts: true
  tasks:

    - name: Mostrar usuário atual (debug whoami)
      command: whoami
      register: whoami_result

    - debug:
        var: whoami_result.stdout

    - name: Verificar se há lock no apt
      shell: lsof /var/lib/apt/lists/lock || echo "sem lock"
      register: apt_lock

    - debug:
        var: apt_lock.stdout_lines

    - name: Atualizar pacotes (Debian-based)
      ansible.builtin.apt:
        update_cache: yes
        upgrade: dist
      when: ansible_os_family == "Debian"

    - name: Atualizar pacotes (RedHat-based)
      ansible.builtin.yum:
        name: '*'
        state: latest
      when: ansible_os_family == "RedHat"
